import{RouterProvider as Z,isPlainObject as _,useRouter as k,useRouterState as R,warning as F,pick as Q,TSR_DEFERRED_PROMISE as X,isPlainArray as Y,defer as ee,createMemoryHistory as te,createControlledPromise as re,createRootRoute as ne,Outlet as se,createFileRoute as ae,lazyRouteComponent as oe,createRouter as ie}from"@tanstack/react-router";import{jsx as f,Fragment as A,jsxs as O}from"react/jsx-runtime";import*as ce from"react";import{createElement as q}from"react";import{eventHandler as de,toWebRequest as ue,getResponseHeaders as le}from"h3";import y from"jsesc";import"node:async_hooks";import{Readable as z,PassThrough as fe}from"node:stream";import{isbot as B}from"isbot";import x from"react-dom/server";import{ReadableStream as me}from"node:stream/web";function W(e){return f(Z,{router:e.router})}function N({tag:e,attrs:r,children:t}){switch(e){case"title":return f("title",{...r,suppressHydrationWarning:!0,children:t});case"meta":return f("meta",{...r,suppressHydrationWarning:!0});case"link":return f("link",{...r,suppressHydrationWarning:!0});case"style":return f("style",{...r,dangerouslySetInnerHTML:{__html:t}});case"script":return r&&r.src?f("script",{...r,suppressHydrationWarning:!0}):typeof t=="string"?f("script",{...r,dangerouslySetInnerHTML:{__html:t},suppressHydrationWarning:!0}):null;default:return null}}function pe(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function L(...e){return e.reduce((r,t)=>{const n=pe(t);for(const[a,s]of n.entries())r.set(a,s);return r},new Headers)}const g={stringify:e=>JSON.stringify(e,function(t,n){const a=this[t],s=H.find(o=>o.stringifyCondition(a));return s?s.stringify(a):n}),parse:e=>JSON.parse(e,function(t,n){const a=this[t];if(_(a)){const s=H.find(o=>o.parseCondition(a));if(s)return s.parse(a)}return n}),encode:e=>{if(Array.isArray(e))return e.map(t=>g.encode(t));if(_(e))return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,g.encode(n)]));const r=H.find(t=>t.stringifyCondition(e));return r?r.stringify(e):e},decode:e=>{if(_(e)){const r=H.find(t=>t.parseCondition(e));if(r)return r.parse(e)}return Array.isArray(e)?e.map(r=>g.decode(r)):_(e)?Object.fromEntries(Object.entries(e).map(([r,t])=>[r,g.decode(t)])):e}},T=(e,r,t,n)=>({key:e,stringifyCondition:r,stringify:a=>({[`$${e}`]:t(a)}),parseCondition:a=>Object.hasOwn(a,`$${e}`),parse:a=>n(a[`$${e}`])}),H=[T("undefined",e=>e===void 0,()=>0,()=>{}),T("date",e=>e instanceof Date,e=>e.toISOString(),e=>new Date(e)),T("error",e=>e instanceof Error,e=>({...e,message:e.message,stack:void 0,cause:e.cause}),e=>Object.assign(new Error(e.message),e)),T("formData",e=>e instanceof FormData,e=>{const r={};return e.forEach((t,n)=>{const a=r[n];a!==void 0?Array.isArray(a)?a.push(t):r[n]=[a,t]:r[n]=t}),r},e=>{const r=new FormData;return Object.entries(e).forEach(([t,n])=>{Array.isArray(n)?n.forEach(a=>r.append(t,a)):r.append(t,n)}),r})],he=()=>{const e=k(),r=R({select:s=>s.matches.map(o=>o.meta).filter(Boolean)}),t=ce.useMemo(()=>{const s=[],o={};let d;return[...r].reverse().forEach(c=>{[...c].reverse().forEach(i=>{if(i)if(i.title)d||(d={tag:"title",children:i.title});else{const u=i.name??i.property;if(u){if(o[u])return;o[u]=!0}s.push({tag:"meta",attrs:{...i}})}})}),d&&s.push(d),s.reverse(),s},[r]),n=R({select:s=>s.matches.map(o=>o.links).filter(Boolean).flat(1).map(o=>({tag:"link",attrs:{...o}})),structuralSharing:!0}),a=R({select:s=>{const o=[];return s.matches.map(d=>e.looseRoutesById[d.routeId]).forEach(d=>{var c,i,u,m;return(m=(u=(i=(c=e.ssr)==null?void 0:c.manifest)==null?void 0:i.routes[d.id])==null?void 0:u.preloads)==null?void 0:m.filter(Boolean).forEach(S=>{o.push({tag:"link",attrs:{rel:"modulepreload",href:S}})})}),o},structuralSharing:!0});return ye([...t,...a,...n],s=>JSON.stringify(s))},Se=()=>{const e=he();return f(A,{children:e.map(r=>q(N,{...r,key:`tsr-meta-${JSON.stringify(r)}`}))})},_e=()=>f(A,{children:Se()});function ye(e,r){const t=new Set;return e.filter(n=>{const a=r(n);return t.has(a)?!1:(t.add(a),!0)})}const ge=()=>{const e=k(),r=R({select:a=>{var s;const o=[],d=(s=e.ssr)==null?void 0:s.manifest;return d?(a.matches.map(c=>e.looseRoutesById[c.routeId]).forEach(c=>{var i,u;return(u=(i=d.routes[c.id])==null?void 0:i.assets)==null?void 0:u.filter(m=>m.tag==="script").forEach(m=>{o.push({tag:"script",attrs:m.attrs,children:m.children})})}),o):(F(!1,"<Scripts /> found no manifest"),[])},structuralSharing:!0}),{scripts:t}=R({select:a=>({scripts:a.matches.map(s=>s.scripts).flat(1).filter(Boolean).map(({children:s,...o})=>({tag:"script",attrs:{...o,suppressHydrationWarning:!0},children:s}))})}),n=[...t,...r];return f(A,{children:n.map((a,s)=>q(N,{...a,key:`tsr-scripts-${a.tag}-${s}`}))})},Re=`const __TSR_SSR__={matches:[],streamedValues:{},initMatch:l=>(__TSR_SSR__.matches.push(l),Object.entries(l.extracted).forEach(([o,r])=>{if(r.type==="stream"){let t;r.value=new ReadableStream({start(e){t={enqueue:a=>{try{e.enqueue(a)}catch{}},close:()=>{try{e.close()}catch{}}}}}),r.value.controller=t}else{let t,e;r.value=new Promise((a,n)=>{e=n,t=a}),r.value.reject=e,r.value.resolve=t}}),!0),resolvePromise:({matchId:l,id:o,promiseState:r})=>{const t=__TSR_SSR__.matches.find(e=>e.id===l);if(t){const e=t.extracted[o];if(e&&e.type==="promise"&&e.value&&r.status==="success")return e.value.resolve(r.data),!0}return!1},injectChunk:({matchId:l,id:o,chunk:r})=>{const t=__TSR_SSR__.matches.find(e=>e.id===l);if(t){const e=t.extracted[o];if(e&&e.type==="stream"&&e.value?.controller)return e.value.controller.enqueue(new TextEncoder().encode(r.toString())),!0}return!1},closeStream:({matchId:l,id:o})=>{const r=__TSR_SSR__.matches.find(t=>t.id===l);if(r){const t=r.extracted[o];if(t&&t.type==="stream"&&t.value?.controller)return t.value.controller.close(),!0}return!1},cleanScripts:()=>{document.querySelectorAll(".tsr-once").forEach(l=>{l.remove()})}};window.__TSR_SSR__=__TSR_SSR__;
`;function we(e,r){e.ssr={manifest:r,serializer:g},e.serverSsr={injectedHtml:[],streamedKeys:new Set,injectHtml:t=>{const n=Promise.resolve().then(t);return e.serverSsr.injectedHtml.push(n),e.emit({type:"onInjectedHtml",promise:n}),n.then(()=>{})},injectScript:(t,n)=>e.serverSsr.injectHtml(async()=>`<script class='tsr-once'>${await t()}; if (typeof __TSR_SSR__ !== 'undefined') __TSR_SSR__.cleanScripts()<\/script>`),streamValue:(t,n)=>{F(!e.serverSsr.streamedKeys.has(t),"Key has already been streamed: "+t),e.serverSsr.streamedKeys.add(t),e.serverSsr.injectScript(()=>`__TSR_SSR__.streamedValues['${t}'] = { value: ${y(e.ssr.serializer.stringify(n),{isScriptContext:!0,wrap:!0,json:!0})}}`)},onMatchSettled:xe},e.serverSsr.injectScript(()=>Re,{logScript:!1})}function be(e){var r,t;const n={manifest:e.ssr.manifest,dehydratedData:(t=(r=e.options).dehydrate)==null?void 0:t.call(r)};e.serverSsr.injectScript(()=>`__TSR_SSR__.dehydrated = ${y(e.ssr.serializer.stringify(n),{isScriptContext:!0,wrap:!0,json:!0})}`)}function Ee(e,r,t){t.match.extracted=t.match.extracted||[];const n=t.match.extracted;return M(r,(s,o)=>{const d=s instanceof ReadableStream?"stream":s instanceof Promise?"promise":void 0;if(d==="stream"){const[c,i]=s.tee(),u={dataType:e,type:d,path:o,id:n.length,matchIndex:t.match.index,stream:i};return n.push(u),c}else if(d==="promise"){const c=ee(s),i={dataType:e,type:d,path:o,id:n.length,matchIndex:t.match.index,promise:c};n.push(i)}return s})}function xe(e){const{router:r,match:t}=e,[n,a]=["__beforeLoadContext","loaderData"].map(o=>{const d=Ee(o,t[o],{router:r,match:t}),c=t.extracted;return c?c.reduce((i,u)=>u.dataType!==o?C(i,["temp",...u.path],void 0):i,{temp:d}).temp:d}),s=t.extracted;if(n!==void 0||a!==void 0||s?.length){let o=function(i){r.serverSsr.injectScript(async()=>(await i.promise,`__TSR_SSR__.resolvePromise(${y({matchId:t.id,id:i.id,promiseState:i.promise[X]},{isScriptContext:!0,wrap:!0,json:!0})})`))},d=function(i){r.serverSsr.injectHtml(async()=>{try{const u=i.stream.getReader();let m=null;for(;!(m=await u.read()).done;)if(m.value){const S=`__TSR_SSR__.injectChunk(${y({matchId:t.id,id:i.id,chunk:m.value},{isScriptContext:!0,wrap:!0,json:!0})})`;r.serverSsr.injectScript(()=>S)}r.serverSsr.injectScript(()=>`__TSR_SSR__.closeStream(${y({matchId:t.id,id:i.id},{isScriptContext:!0,wrap:!0,json:!0})})`)}catch(u){console.error("stream read error",u)}return""})};const c=`__TSR_SSR__.initMatch(${y({id:t.id,__beforeLoadContext:r.ssr.serializer.stringify(n),loaderData:r.ssr.serializer.stringify(a),error:r.ssr.serializer.stringify(t.error),extracted:s?Object.fromEntries(s.map(i=>[i.id,Q(i,["type","path"])])):{},updatedAt:t.updatedAt,status:t.status},{isScriptContext:!0,wrap:!0,json:!0})})`;r.serverSsr.injectScript(()=>c),s&&s.forEach(i=>i.type==="promise"?o(i):d(i))}return null}function C(e,r,t){if(r.length===0)return t;const[n,...a]=r;return Array.isArray(e)?e.map((s,o)=>o===Number(n)?C(s,a,t):s):_(e)?{...e,[n]:C(e[n],a,t)}:e}function M(e,r,t=[]){if(Y(e))return e.map((a,s)=>M(a,r,[...t,`${s}`]));if(_(e)){const a={};for(const s in e)a[s]=M(e[s],r,[...t,s]);return a}const n=r(e,t);return n!==e?n:e}function Te({createRouter:e,getRouterManifest:r}){return t=>de(async n=>{const a=ue(n),s=new URL(a.url),o=s.href.replace(s.origin,""),d=te({initialEntries:[o]}),c=e();we(c,r?.()),c.update({history:d}),await c.load(),be(c);const i=He({event:n,router:c});return await t({request:a,router:c,responseHeaders:i})})}function He(e){e.event.__tsrHeadersSent=!0;let r=L(le(e.event),{"Content-Type":"text/html; charset=UTF-8"},...e.router.state.matches.map(n=>n.headers));const{redirect:t}=e.router.state;return t&&(r=L(r,t.headers,{Location:t.href})),r}function je(e,r){return U(e,r)}function ve(e,r){return z.fromWeb(U(e,z.toWeb(r)))}const Ce=/(<body)/,Me=/(<\/body>)/,Ae=/(<\/html>)/,Ie=/(<head.*?>)/,Pe=/(<\/[a-zA-Z][\w:.-]*?>)/g,De=new TextDecoder;function $e(){let e;const t={stream:new me({start(n){e=n}}),write:n=>{e.enqueue(n)},end:n=>{n&&e.enqueue(n),e.close(),t.destroyed=!0},destroy:n=>{e.error(n)},destroyed:!1};return t}async function Oe(e,r){var t,n,a;try{const s=e.getReader();let o;for(;!(o=await s.read()).done;)(t=r.onData)==null||t.call(r,o);(n=r.onEnd)==null||n.call(r)}catch(s){(a=r.onError)==null||a.call(r,s)}}function U(e,r){const t=$e();let n=!0,a="",s="",o=!1,d=!1,c="",i="";function u(){const l=a;return a="",l}function m(l){return l instanceof Uint8Array?De.decode(l):String(l)}const S=re();let w=0;e.serverSsr.injectedHtml.forEach(l=>{I(l)});const K=e.subscribe("onInjectedHtml",l=>{I(l.promise)});function I(l){w++,l.then(b=>{o?t.write(b):a+=b}).catch(S.reject).finally(()=>{w--,!n&&w===0&&(K(),S.resolve())})}return S.then(()=>{const l=i+u()+s;t.end(l)}).catch(l=>{console.error("Error reading routerStream:",l),t.destroy(l)}),Oe(r,{onData:l=>{const b=m(l.value),p=c+b,j=p.match(Me),P=p.match(Ae);if(o||p.match(Ce)&&(o=!0),!d){const h=p.match(Ie);if(h){d=!0;const D=h.index,$=h[0],G=p.slice(D+$.length);t.write(p.slice(0,D)+$+u()+G);return}}if(!o){t.write(p),c="";return}if(j&&P&&j.index<P.index){const h=j.index;s=p.slice(h),t.write(p.slice(0,h)+u()),c="";return}let v,E=0;for(;(v=Pe.exec(p))!==null;)E=v.index+v[0].length;if(E>0){const h=p.slice(0,E)+u()+i;t.write(h),c=p.slice(E)}else c=p,i+=u()},onEnd:()=>{n=!1,w===0&&S.resolve()},onError:l=>{console.error("Error reading appStream:",l),t.destroy(l)}}),t.stream}const ze=async({request:e,router:r,responseHeaders:t})=>{if(typeof x.renderToReadableStream=="function"){const n=await x.renderToReadableStream(f(W,{router:r}),{signal:e.signal});B(e.headers.get("User-Agent"))&&await n.allReady;const a=je(r,n);return new Response(a,{status:r.state.statusCode,headers:t})}if(typeof x.renderToPipeableStream=="function"){const n=new fe;try{const s=x.renderToPipeableStream(f(W,{router:r}),{...B(e.headers.get("User-Agent"))?{onAllReady(){s.pipe(n)}}:{onShellReady(){s.pipe(n)}},onError:(o,d)=>{console.error("Error in renderToPipeableStream:",o,d)}})}catch(s){console.error("Error in renderToPipeableStream:",s)}const a=ve(r,n);return new Response(a,{status:r.state.statusCode,headers:t})}throw new Error("No renderToReadableStream or renderToPipeableStream found in react-dom/server. Ensure you are using a version of react-dom that supports streaming.")},Be=()=>({routes:{__root__:{filePath:"__root.tsx",children:["/hello"],preloads:["/_build/assets/client-DWfUwVND.js","/_build/assets/client-BE1L4nLD.js"]},"/hello":{filePath:"hello.tsx"}}});function We(e){return globalThis.MANIFEST[e]}function Le(){const e=Be(),r=e.routes.__root__=e.routes.__root__||{};r.assets=r.assets||[];const t=We("client");return r.assets.push({tag:"script",attrs:{src:t.inputs[t.handler]?.output.path,type:"module",suppressHydrationWarning:!0,async:!0}}),e}function ke(){const e=Le();return{...e,routes:Object.fromEntries(Object.entries(e.routes).map(([r,t])=>{const{preloads:n,assets:a}=t;return[r,{preloads:n,assets:a}]}))}}const V=ne({head:()=>({meta:[{charSet:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{title:"TanStack Start Starter"}]}),component:Fe});function Fe(){return f(qe,{children:f(se,{})})}function qe({children:e}){return O("html",{children:[f("head",{children:f(_e,{})}),O("body",{children:[e,f(ge,{})]})]})}const Ne=()=>import("./assets/hello-B_RPfLMU.js"),J=ae("/hello")({component:oe(Ne,"component",()=>J.ssr)}),Ue=J.update({id:"/hello",path:"/hello",getParentRoute:()=>V}),Ve={HelloRoute:Ue},Je=V._addFileChildren(Ve)._addFileTypes();function Ke(){return ie({routeTree:Je})}const at=Te({createRouter:Ke,getRouterManifest:ke})(ze);export{at as default};
